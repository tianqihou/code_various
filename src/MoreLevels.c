#include "defines.h"

enum ExpType
{
    MedFast,
    Erratic,
    Fluct,
    MedSlow,
    Fast,
    Slow,
};

#if MORELEVELS == true

const struct exp_group exp_table[6] = {
        {{0, 1, 8, 27, 64, 125, 216, 343, 512, 729, 1000,
    1331, 1728, 2197, 2744, 3375, 4096, 4913, 5832, 6859, 8000,
    9261, 10648, 12167, 13824, 15625, 17576, 19683, 21952, 24389, 27000,
    29791, 32768, 35937, 39304, 42875, 46656, 50653, 54872, 59319, 64000,
    68921, 74088, 79507, 85184, 91125, 97336, 103823, 110592, 117649, 125000,
    132651, 140608, 148877, 157464, 166375, 175616, 185193, 195112, 205379, 216000,
    226981, 238328, 250047, 262144, 274625, 287496, 300763, 314432, 328509, 343000,
    357911, 373248, 389017, 405224, 421875, 438976, 456533, 474552, 493039, 512000,
    531441, 551368, 571787, 592704, 614125, 636056, 658503, 681472, 704969, 729000,
    753571, 778688, 804357, 830584, 857375, 884736, 912673, 941192, 970299, 1000000,
    1030301, 1061208, 1092727, 1124864, 1157625, 1191016, 1225043, 1259712, 1295029, 1331000,
    1367631, 1404928, 1442897, 1481544, 1520875, 1560896, 1601613, 1643032, 1685159, 1728000,
    1771561, 1815848, 1860867, 1906624, 1953125, 2000376, 2048383, 2097152, 2146689, 2197000,
    2248091, 2299968, 2352637, 2406104, 2460375, 2515456, 2571353, 2628072, 2685619, 2744000,
    2803221, 2863288, 2924207, 2985984, 3048625, 3112136, 3176523, 3241792, 3307949, 3375000,
    3442951, 3511808, 3581577, 3652264, 3723875, 3796416, 3869893, 3944312, 4019679, 4096000,
    4173281, 4251528, 4330747, 4410944, 4492125, 4574296, 4657463, 4741632, 4826809, 4913000,
    5000211, 5088448, 5177717, 5268024, 5359375, 5451776, 5545233, 5639752, 5735339, 5832000,
    5929741, 6028568, 6128487, 6229504, 6331625, 6434856, 6539203, 6644672, 6751269, 6859000,
    6967871, 7077888, 7189057, 7301384, 7414875, 7529536, 7645373, 7762392, 7880599, 8000000,
    8120601, 8242408, 8365427, 8489664, 8615125, 8741816, 8869743, 8998912, 9129329, 9261000,
    9393931, 9528128, 9663597, 9800344, 9938375, 10077696, 10218313, 10360232, 10503459, 10648000,
    10793861, 10941048, 11089567, 11239424, 11390625, 11543176, 11697083, 11852352, 12008989, 12167000,
    12326391, 12487168, 12649337, 12812904, 12977875, 13144256, 13312053, 13481272, 13651919, 13824000,
    13997521, 14172488, 14348907, 14526784, 14706125, 14886936, 15069223, 15252992, 15438249, 15625000,
    15813251, 16003008, 16194277, 16387064}},
        {{0, 1, 15, 52, 122, 237, 406, 637, 942, 1326, 1800,
    2369, 3041, 3822, 4719, 5737, 6881, 8155, 9564, 11111, 12800,
    14632, 16610, 18737, 21012, 23437, 26012, 28737, 31610, 34632, 37800,
    41111, 44564, 48155, 51881, 55737, 59719, 63822, 68041, 72369, 76800,
    81326, 85942, 90637, 95406, 100237, 105122, 110052, 115015, 120001, 125000,
    131324, 137795, 144410, 151165, 158056, 165079, 172229, 179503, 186894, 194400,
    202013, 209728, 217540, 225443, 233431, 241496, 249633, 257834, 267406, 276915,
    286567, 296358, 306286, 316344, 326531, 336840, 347269, 357812, 368464, 379221,
    390077, 401028, 412067, 423190, 434391, 445663, 457001, 468398, 479848, 491346,
    502883, 514453, 526049, 537664, 549291, 560922, 572550, 584166, 591882, 600000,
    679998, 693322, 706630, 719912, 733162, 746370, 759526, 772623, 785650, 798600,
    811461, 824224, 836880, 849418, 861829, 874101, 886225, 898190, 909985, 921600,
    933022, 944240, 955245, 966022, 976562, 986852, 996879, 1006632, 1016099, 1025266,
    1034121, 1042652, 1050844, 1058685, 1066162, 1073261, 1079968, 1086269, 1092151, 1097600,
    1102600, 1107138, 1111198, 1114767, 1117829, 1120368, 1122371, 1123821, 1124702, 1125000,
    1704260, 1720785, 1737064, 1753086, 1768840, 1784315, 1799500, 1814383, 1828953, 1843200,
    1857110, 1870672, 1883874, 1896705, 1909153, 1921204, 1932847, 1944069, 1964511, 1983214,
    2001751, 2020113, 2038294, 2056285, 2074078, 2091664, 2109036, 2126186, 2143105, 2159784,
    2176214, 2192389, 2208298, 2223932, 2239284, 2254344, 2269103, 2283552, 2297681, 2311483,
    2324946, 2338062, 2350821, 2363214, 2375231, 2386862, 2398098, 2408928, 8458509, 8533333,
    8607837, 8682003, 8755813, 8829250, 8902295, 8974931, 9047137, 9118897, 9190191, 9261000,
    9331304, 9401086, 9470325, 9539001, 9607095, 9674588, 9741458, 9807686, 9873251, 9938133,
    10002311, 10065764, 10128471, 10190411, 10251562, 10311903, 10371413, 10430069, 10487850, 10544733,
    10600696, 10655716, 10709771, 10762839, 10814895, 10865918, 10915883, 10964767, 11012547, 11059200,
    11104699, 11149023, 11192147, 11234046, 11274695, 11314071, 11352147, 11388900, 11424304, 11458333,
    11490962, 11522165, 11551917, 11580191}},
        {{0, 1, 4, 13, 32, 64, 112, 178, 276, 393, 540,
    745, 967, 1230, 1591, 1957, 2457, 3046, 3732, 4526, 5440,
    6482, 7666, 9003, 10506, 12187, 14060, 16140, 18439, 20974, 23760,
    26811, 30146, 33780, 37731, 42017, 46656, 50652, 55969, 60505, 66560,
    71677, 78533, 84277, 91998, 98414, 107069, 114205, 123863, 131766, 142500,
    151222, 163105, 172697, 185807, 196322, 210739, 222231, 238036, 250562, 267840,
    281456, 300293, 315059, 335544, 351520, 373744, 390991, 415050, 433631, 459620,
    479600, 507617, 529063, 559209, 582187, 614566, 639146, 673863, 700115, 737280,
    765275, 804997, 834809, 877201, 908904, 954084, 987754, 1035837, 1071552, 1122660,
    1160499, 1214753, 1254796, 1312322, 1354652, 1415577, 1460276, 1524731, 1571884, 1640000,
    1651627, 1709273, 1760041, 1820390, 1873408, 1936537, 1991863, 2057850, 2115543, 2184465,
    2244585, 2316522, 2379127, 2454160, 2519312, 2597521, 2665279, 2746748, 2817174, 2901984,
    2975140, 3063377, 3139325, 3231072, 3309875, 3405220, 3486942, 3585969, 3670674, 3773473,
    3861224, 3967883, 4058747, 4169355, 4263397, 4378045, 4475331, 4594110, 4694708, 4817709,
    4921685, 5049004, 5156426, 5288154, 5399091, 5535325, 5649846, 5790681, 5908855, 6054389,
    6176286, 6326615, 6452306, 6607531, 6737086, 6897305, 7030797, 7196111, 7333612, 7504122,
    7645705, 7821513, 7967252, 8148461, 8298429, 8485144, 8639416, 8831742, 8990392, 9188435,
    9351539, 9555406, 9723041, 9932839, 10105081, 10320919, 10497845, 10719833, 10901522, 11129770,
    11316299, 11550920, 11742368, 11983473, 12179919, 12427622, 12629147, 12883562, 13090246, 13351488,
    13563413, 13831597, 14048844, 14324089, 14546739, 14829162, 15057299, 15347019, 15580726, 15877862,
    16117223, 16421896, 16666995, 16979328, 17230250, 17550363, 17807193, 18135211, 18398037, 18734083,
    19002990, 19347191, 19622265, 19974746, 20256077, 20616965, 20904640, 21274064, 21568171, 21946259,
    22246889, 22633771, 22941012, 23336819, 23650763, 24055626, 24376363, 24790415, 25118038, 25541412,
    25876011, 26308842, 26650511, 27092934, 27441766, 27893917, 28250005, 28712022, 29075461, 29547480,
    29918365, 30400527, 30778953, 31271397, 31657459, 32160327, 32554122, 33067555, 33469181, 33993320,
    34402874, 34937864, 35355444, 35901430}},
        {{0, 1, 9, 57, 96, 134, 179, 236, 314, 419, 560,
    742, 973, 1261, 1612, 2034, 2535, 3120, 3798, 4575, 5460,
    6458, 7577, 8825, 10208, 11734, 13411, 15244, 17242, 19411, 21760,
    24294, 27021, 29949, 33084, 36434, 40007, 43808, 47846, 52127, 56660,
    61450, 66505, 71833, 77440, 83334, 89523, 96012, 102810, 109923, 117360,
    125126, 133229, 141677, 150476, 159634, 169159, 179056, 189334, 199999, 211060,
    222522, 234393, 246681, 259392, 272534, 286115, 300140, 314618, 329555, 344960,
    360838, 377197, 394045, 411388, 429234, 447591, 466464, 485862, 505791, 526260,
    547274, 568841, 590969, 613664, 636934, 660787, 685228, 710266, 735907, 762160,
    789030, 816525, 844653, 873420, 902834, 932903, 963632, 995030, 1027103, 1059860,
    1093306, 1127449, 1162297, 1197856, 1234134, 1271139, 1308876, 1347354, 1386579, 1426560,
    1467302, 1508813, 1551101, 1594172, 1638034, 1682695, 1728160, 1774438, 1821535, 1869460,
    1918218, 1967817, 2018265, 2069568, 2121734, 2174771, 2228684, 2283482, 2339171, 2395760,
    2453254, 2511661, 2570989, 2631244, 2692434, 2754567, 2817648, 2881686, 2946687, 3012660,
    3079610, 3147545, 3216473, 3286400, 3357334, 3429283, 3502252, 3576250, 3651283, 3727360,
    3804486, 3882669, 3961917, 4042236, 4123634, 4206119, 4289696, 4374374, 4460159, 4547060,
    5093932, 5188363, 5283961, 5380732, 5478684, 5577825, 5678160, 5779698, 5882445, 5986410,
    6091598, 6198017, 6305675, 6414578, 6524734, 6636151, 6748834, 6862792, 6978031, 7094560,
    7212384, 7331511, 7451949, 7573704, 7696784, 7821197, 7946948, 8074046, 8202497, 8332310,
    8463490, 8596045, 8729983, 8865310, 9002034, 9140163, 9279702, 9420660, 9563043, 9706860,
    9852116, 9998819, 10146977, 10296596, 10447684, 10600249, 10754296, 10909834, 11066869, 11225410,
    11385462, 11547033, 11710131, 11874762, 12040934, 12208655, 12377930, 12548768, 12721175, 12895160,
    13070728, 13247887, 13426645, 13607008, 13788984, 13972581, 14157804, 14344662, 14533161, 14723310,
    14915114, 15108581, 15303719, 15500534, 15699034, 15899227, 16101118, 16304716, 16510027, 16717060,
    16925820, 17136315, 17348553, 17562540, 17778284, 17995793, 18215072, 18436130, 18658973, 18883610,
    19110046, 19338289, 19568347, 19800226}},
        {{0, 1, 6, 21, 51, 100, 172, 274, 409, 583, 800,
    1064, 1382, 1757, 2195, 2700, 3276, 3930, 4665, 5487, 6400,
    7408, 8518, 9733, 11059, 12500, 14060, 15746, 17561, 19511, 21600,
    23832, 26214, 28749, 31443, 34300, 37324, 40522, 43897, 47455, 51200,
    55136, 59270, 63605, 68147, 72900, 77868, 83058, 88473, 94119, 100000,
    106120, 112486, 119101, 125971, 133100, 140492, 148154, 156089, 164303, 172800,
    181584, 190662, 200037, 209715, 219700, 229996, 240610, 251545, 262807, 274400,
    286328, 298598, 311213, 324179, 337500, 351180, 365226, 379641, 394431, 409600,
    425152, 441094, 457429, 474163, 491300, 508844, 526802, 545177, 563975, 583200,
    602856, 622950, 643485, 664467, 685900, 707788, 730138, 752953, 776239, 800000,
    824240, 848966, 874181, 899891, 926100, 952812, 980034, 1007769, 1036023, 1064800,
    1094104, 1123942, 1154317, 1185235, 1216700, 1248716, 1281290, 1314425, 1348127, 1382400,
    1417248, 1452678, 1488693, 1525299, 1562500, 1600300, 1638706, 1677721, 1717351, 1757600,
    1798472, 1839974, 1882109, 1924883, 1968300, 2012364, 2057082, 2102457, 2148495, 2195200,
    2242576, 2290630, 2339365, 2388787, 2438900, 2489708, 2541218, 2593433, 2646359, 2700000,
    2754360, 2809446, 2865261, 2921811, 2979100, 3037132, 3095914, 3155449, 3215743, 3276800,
    3338624, 3401222, 3464597, 3528755, 3593700, 3659436, 3725970, 3793305, 3861447, 3930400,
    4000168, 4070758, 4142173, 4214419, 4287500, 4361420, 4436186, 4511801, 4588271, 4665600,
    4743792, 4822854, 4902789, 4983603, 5065300, 5147884, 5231362, 5315737, 5401015, 5487200,
    5574296, 5662310, 5751245, 5841107, 5931900, 6023628, 6116298, 6209913, 6304479, 6400000,
    6496480, 6593926, 6692341, 6791731, 6892100, 6993452, 7095794, 7199129, 7303463, 7408800,
    7515144, 7622502, 7730877, 7840275, 7950700, 8062156, 8174650, 8288185, 8402767, 8518400,
    8635088, 8752838, 8871653, 8991539, 9112500, 9234540, 9357666, 9481881, 9607191, 9733600,
    9861112, 9989734, 10119469, 10250323, 10382300, 10515404, 10649642, 10785017, 10921535, 11059200,
    11198016, 11337990, 11479125, 11621427, 11764900, 11909548, 12055378, 12202393, 12350599, 12500000,
    12650600, 12802406, 12955421, 13109651}},
        {{0, 1, 10, 33, 80, 156, 270, 428, 640, 911, 1250,
    1663, 2160, 2746, 3430, 4218, 5120, 6141, 7290, 8573, 10000,
    11576, 13310, 15208, 17280, 19531, 21970, 24603, 27440, 30486, 33750,
    37238, 40960, 44921, 49130, 53593, 58320, 63316, 68590, 74148, 80000,
    86151, 92610, 99383, 106480, 113906, 121670, 129778, 138240, 147061, 156250,
    165813, 175760, 186096, 196830, 207968, 219520, 231491, 243890, 256723, 270000,
    283726, 297910, 312558, 327680, 343281, 359370, 375953, 393040, 410636, 428750,
    447388, 466560, 486271, 506530, 527343, 548720, 570666, 593190, 616298, 640000,
    664301, 689210, 714733, 740880, 767656, 795070, 823128, 851840, 881211, 911250,
    941963, 973360, 1005446, 1038230, 1071718, 1105920, 1140841, 1176490, 1212873, 1250000,
    1287876, 1326510, 1365908, 1406080, 1447031, 1488770, 1531303, 1574640, 1618786, 1663750,
    1709538, 1756160, 1803621, 1851930, 1901093, 1951120, 2002016, 2053790, 2106448, 2160000,
    2214451, 2269810, 2326083, 2383280, 2441406, 2500470, 2560478, 2621440, 2683361, 2746250,
    2810113, 2874960, 2940796, 3007630, 3075468, 3144320, 3214191, 3285090, 3357023, 3430000,
    3504026, 3579110, 3655258, 3732480, 3810781, 3890170, 3970653, 4052240, 4134936, 4218750,
    4303688, 4389760, 4476971, 4565330, 4654843, 4745520, 4837366, 4930390, 5024598, 5120000,
    5216601, 5314410, 5413433, 5513680, 5615156, 5717870, 5821828, 5927040, 6033511, 6141250,
    6250263, 6360560, 6472146, 6585030, 6699218, 6814720, 6931541, 7049690, 7169173, 7290000,
    7412176, 7535710, 7660608, 7786880, 7914531, 8043570, 8174003, 8305840, 8439086, 8573750,
    8709838, 8847360, 8986321, 9126730, 9268593, 9411920, 9556716, 9702990, 9850748, 10000000,
    10150751, 10303010, 10456783, 10612080, 10768906, 10927270, 11087178, 11248640, 11411661, 11576250,
    11742413, 11910160, 12079496, 12250430, 12422968, 12597120, 12772891, 12950290, 13129323, 13310000,
    13492326, 13676310, 13861958, 14049280, 14238281, 14428970, 14621353, 14815440, 15011236, 15208750,
    15407988, 15608960, 15811671, 16016130, 16222343, 16430320, 16640066, 16851590, 17064898, 17280000,
    17496901, 17715610, 17936133, 18158480, 18382656, 18608670, 18836528, 19066240, 19297811, 19531250,
    19766563, 20003760, 20242846, 20483830}}
};

struct rbox_rom ExpRbox = {0, 0x16, 0xE, 8, 4, 6, 0x21F};

#endif // MORELEVELS

#if COLORED_STATS == true

void set_nature_color(u8 nature, u8 stat, u8 text_ptr[])
{
    text_ptr[0] = 0xFC;
    text_ptr[1] = 1;
    if (stat <= 5)
    {
        switch (nature_stat_table[nature].stat[stat])
        {
        case 0:
            text_ptr[2] = 1;
            break;
        case 1:
            text_ptr[2] = 5;
            break;
        case 0xFF:
            text_ptr[2] = 7;
            break;
        }
    }
}

#endif // COLORED_STATS

void display_stats_on_left()
{
    u8 text_stat_ptrs[4][16];
    u16* stats = &poke_summary->curr_hp;
    clear_f7_texts();
    u8 index = 0;
    u8 digits = 3;
    if (stats[1] > 999) //if max hp has four digits change font size
    {
        text_stat_ptrs[0][0] = 0xFC;
        text_stat_ptrs[0][1] = 6;
        text_stat_ptrs[0][2] = 0;
        index = 3;
        digits = 4;
    }
    unsigned_int_to_string(&text_stat_ptrs[0][index], stats[0], 1, digits);
    unsigned_int_to_string(&text_stat_ptrs[1], stats[1], 1, digits);
    if (index == 3)
    {
        text_stat_ptrs[2][0] = 0xFC;
        text_stat_ptrs[2][1] = 6;
        text_stat_ptrs[2][2] = 1;
    }
    #if COLORED_STATS == true
    u8 nature = poke_summary->nature;
    set_nature_color(nature, 0, &text_stat_ptrs[2][index]);
    index += 3;
    #endif // COLORED_STATS
    unsigned_int_to_string(&text_stat_ptrs[2][index], stats[2], 1, 7);
    index = 0;
    #if COLORED_STATS == true
    set_nature_color(nature, 1, &text_stat_ptrs[3][index]);
    index += 3;
    #endif // COLORED_STATS
    unsigned_int_to_string(&text_stat_ptrs[3][index], stats[3], 1, 7);
    for (u8 i = 0; i < 4; i++)
    {
        store_f7_text(i, &text_stat_ptrs[i]);
    }
    display_f7_texts(&displayed_string, (void*)(0x0861CE82));
}

void display_stats_on_right()
{
    u8 text_stat_ptrs[3][13];
    clear_f7_texts();
    u16* stats = &poke_summary->sp_atk;
    #if COLORED_STATS == true
    u8 nature = poke_summary->nature;
    #endif // COLORED_STATS
    for (u8 i = 0; i < 3; i++)
    {
        u8 digits = 3;
        u16 stat = stats[i];
        text_stat_ptrs[i][0] = 0xFC;
        text_stat_ptrs[i][1] = 0x6;
        if (stat > 999)
        {
            text_stat_ptrs[i][2] = 0;
            digits = 4;
        }
        else
        {
            text_stat_ptrs[i][2] = 1;
        }
        u8 index = 3;
        #if COLORED_STATS == true
        u8 n_stat = 2;
        if (i == 0)
            n_stat = 3;
        else if (i == 1)
            n_stat = 4;
        set_nature_color(nature, n_stat, &text_stat_ptrs[i][3]);
        index += 3;
        #endif // COLORED_STATS
        unsigned_int_to_string(&text_stat_ptrs[i][index], stat, 1, digits);
        store_f7_text(i, &text_stat_ptrs[i]);
    }
    display_f7_texts(&displayed_string, (void*)(0x0861CE8E));
}

#if MORELEVELS == true

void display_exp_instatssummary()
{
    u8 rboxID = pokesummary_create_rbox(&ExpRbox - 4, 4);
    unsigned_int_to_string(&script_text_buff1[2], poke_summary->owned_exp, 1, 10);
    script_text_buff1[0] = 0x77;
    script_text_buff1[1] = 0x77;
    string_box_build(rboxID, &script_text_buff1[0], 0xF4, 1, 0x0, 0x0);
    u32 needed_exp = 0;
    if (poke_summary->lvl != MAX_LEVEL)
    {
        enum ExpType TypeExp = (*basestat_table)[poke_summary->species].exp_curve;
        needed_exp = exp_table[TypeExp].required[poke_summary->lvl + 1] - poke_summary->owned_exp;
    }
    unsigned_int_to_string(&script_text_buff1[0], needed_exp, 1, 10);
    string_box_build(rboxID, &script_text_buff1[0], 0, 0x11, 0, 0);
    return;
}

void pokemenu_print_HP(u16 value, struct pokemenu* menu, u8 curr)
{
    s8 to_sub = -1;
    if (curr)
    {
        to_sub = 8;
    }
    u8 digits = 4;
    if (!curr)
    {
        if (value <= 9)
            digits = 2;
        else if (value <= 99)
            digits = 3;
        else if (value <= 999)
            to_sub = 0;
    }
    u8* text_ptr = unsigned_int_to_string(&script_text_buff1, value, 1, digits);
    if (curr)
    {
        text_ptr[0] = 0xBA;
        text_ptr[1] = 0xFF;
    }
    else
    {
        text_ptr[0] = 0xFF;
    }
    u8* ptr;
    if (curr)
        ptr = (u8*) (menu->field_0) + 0x10;
    else
        ptr = (u8*) (menu->field_0) + 0x14;
    void* clr_ptr = (void*) (0x86157FC);
    fbox_print_sth(menu->field_8, 0, ptr[0] - to_sub, ptr[1], clr_ptr, 0, &script_text_buff1);
}

void pokemenu_print_currHP(u16 value, struct pokemenu* menu)
{
    pokemenu_print_HP(value, menu, 1);
}

void pokemenu_print_maxHP(u16 value, struct pokemenu* menu)
{
    pokemenu_print_HP(value, menu, 0);
}

#endif // MORELEVELS
